<?php/** * Created by PhpStorm. * User: Administrator * Date: 2018/3/28 0028 * Time: 10:50 */namespace app\rep\controller;use app\controller\model\RepModel;use app\rep\validate\VLogin;use think\Db;use think\Controller;use think\Request;use think\Session;class Login extends Controller{    public function login()    {        return $this->fetch();    }    public function check()    {        $username = input('username');        $password = input('password');        $post_data = input('post.');        $validate = new VLogin();        $result = $validate->scene('edit')->check($post_data);        if (true !== $result) {            // 验证失败 输出错误信息            return returnState(100, $result);        }        $Rep = new RepModel();        $user = $Rep->where(['rep_username'=>$username,'rep_status'=>1])->find();        if (!$user) {            return returnState(100, '用户名不存在，或用户已禁用');        } else if ($user['rep_password'] != md5($password)) {            return returnState(100, '密码错误，请重新输入');        }        $Rep->where('rep_id', $user['rep_id'])->update([            'rep_last_time' => date('Y-m-d H:i:s'),            'rep_last_ip' => Request::instance()->ip(),        ]);        session('rep_id', $user->rep_id);        session('rep_agent_id', $user['rep_agent_id']);        session('rep_name', $user['rep_name']);        session('rep_username', $user['rep_username']);        return returnState(200, '验证成功');    }    /**     * 登出系统     */    public function logout()    {        Session::clear();        $this->redirect(url('Login/login'));    }}